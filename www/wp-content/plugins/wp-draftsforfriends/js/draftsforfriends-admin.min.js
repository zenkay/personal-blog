(function(b){var f=b("#draftsforfriends-add"),c=b("#draftsforfriends-current");b('input[name="draftsforfriends_submit"]',f).on("click",function(){var a={id:1,post_id:parseInt(b('select[name="post_id"]',f).val(),10),expires:parseInt(b('input[name="expires"]',f).val(),10),measure:b('select[name="measure"]',f).val(),nonce:b("#draftsforfriends-add-nonce").val()};e.validate(a)&&e.addSharedDraft(a)});c.on("click",'input[name="draftsforfriends_extend_submit"]',function(a){a=b(this).parent("form");var d=
	parseInt(b('input[name="id"]',a).val(),10);a={id:d,post_id:parseInt(b('input[name="post_id"]',a).val(),10),expires:parseInt(b('input[name="expires"]',a).val(),10),measure:b('select[name="measure"]',a).val(),nonce:b("#draftsforfriends-extend-"+d+"-nonce").val()};e.validate(a)&&e.extendSharedDraft(a)});c.on("click","a.expand",function(a){a.preventDefault();a=b(this).data("id");b("#draftsforfriends-current-"+a).find(".expanded").css("display","inline").end().find(".collapsed").css("display","none").end().find(".row-actions").css("visibility",
	"visible")});c.on("click","a.collapse",function(a){a.preventDefault();a=b(this).data("id");b("#draftsforfriends-current-"+a).find(".collapsed").css("display","inline").end().find(".expanded").css("display","none").end().find(".row-actions").removeAttr("style")});c.on("click","a.delete",function(a){a.preventDefault();a={id:parseInt(b(this).data("id"),10),post_id:parseInt(b(this).data("post_id"),10),post_title:b(this).data("post_title"),expires:1,measure:"s",nonce:b(this).data("nonce")};confirm(draftsForFriendsAdminL10n.confirm_delete.replace("{{post_title}}",
	a.post_title))&&e.validate(a)&&e.deleteSharedDraft(a)});var e={_showMessage:function(a,d){b("#draftsforfriends-message").text(d).removeClass().addClass("updated fade "+a).show()},_toggleEmptyMessage:function(a){"show"==a?b(".empty-row",c).length?b(".empty-row",c).show():b('<tr class="empty-row"><td colspan="6" style="text-align: center;">'+draftsForFriendsAdminL10n.no_shared_drafts+"</td></tr>").appendTo(b("tbody",c)):b(".empty-row",c).length&&b(".empty-row",c).hide()},validate:function(a){return isNaN(a.id)||
	0>=a.id?(alert(draftsForFriendsAdminL10n.error_id),!1):isNaN(a.post_id)||0>=a.post_id?(alert(draftsForFriendsAdminL10n.error_post_id),!1):isNaN(a.expires)||0>=a.expires?(alert(draftsForFriendsAdminL10n.error_expires),!1):""===b.trim(a.nonce)?(alert(draftsForFriendsAdminL10n.empty_nonce),!1):""===b.trim(a.measure)?(alert(draftsForFriendsAdminL10n.empty_measure),!1):!0},addSharedDraft:function(a){var d=this;return b.ajax({type:"post",dataType:"json",url:draftsForFriendsAdminL10n.admin_ajax_url,data:"action=draftsforfriends_admin&do=add&post_id="+
	a.post_id+"&expires="+a.expires+"&measure="+a.measure+"&_ajax_nonce="+a.nonce,cache:!1}).done(function(a){a.success?(d._showMessage("success",a.success),b(a.html).hide().prependTo(b("tbody",c)).fadeIn(),b("#draftsforfriends-current-count").text(a.count),d._toggleEmptyMessage("hide")):d._showMessage("error",a.error)}).fail(function(a,b,c){d._showMessage("error",c)})},extendSharedDraft:function(a){var d=this;return b.ajax({type:"post",dataType:"json",url:draftsForFriendsAdminL10n.admin_ajax_url,data:"action=draftsforfriends_admin&do=extend&id="+
	a.id+"&post_id="+a.post_id+"&expires="+a.expires+"&measure="+a.measure+"&_ajax_nonce="+a.nonce,cache:!1}).done(function(a){if(a.success){d._showMessage("success",a.success);var c="#draftsforfriends-current-"+a.shared.id;b(c).replaceWith(a.html);b(c).css("background-color","#dff0d8").animate({backgroundColor:"#fcfcfc"},1E3)}else d._showMessage("error",a.error)}).fail(function(a,b,c){d._showMessage("error",c)})},deleteSharedDraft:function(a){var d=this;return b.ajax({type:"post",dataType:"json",url:draftsForFriendsAdminL10n.admin_ajax_url,
	data:"action=draftsforfriends_admin&do=delete&id="+a.id+"&post_id="+a.post_id+"&_ajax_nonce="+a.nonce,cache:!1}).done(function(a){if(a.success){d._showMessage("success",a.success);var e=b("#draftsforfriends-current-"+a.shared.id);e.length&&e.fadeOut("normal",function(){this.remove();0==b("> tbody > tr:not(.empty-row)",c).length&&d._toggleEmptyMessage("show")});b("#draftsforfriends-current-count").text(a.count)}else d._showMessage("error",a.error)}).fail(function(a,b,c){d._showMessage("error",c)})}}})(jQuery);